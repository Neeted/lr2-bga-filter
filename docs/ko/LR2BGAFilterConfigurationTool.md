# LR2BGAFilterConfigurationTool

## 개요

LR2BGAFilterConfigurationTool는 LR2BGAFilter의 설정을 수행하기 위한 도구입니다.

## 사용법

1. `LR2BGAFilterConfigurationTool.bat`를 실행합니다.
2. 각종 설정을 실시합니다.
3. `OK` 버튼을 눌러 설정을 보존합니다.

## 설정 항목

### LR2 Output

- [ ] Dummy: LR2에 더미 검은 화면(1x1)을 1 프레임만 출력합니다.
- [ ] Passthrough: 입력 해상도 그대로 LR2에 출력합니다. 블랙 바 제거는 적용됩니다.
- [ ] Keep Aspect: 입력 동영상의 종횡비(Aspect Ratio)를 유지하기 위해 블랙 바를 부가하여 LR2에 출력합니다.
- [ ] Limit FPS: LR2에 출력하는 프레임 레이트를 제한합니다.
- Size: LR2에 출력하는 해상도를 설정합니다. **스킨의 BGA 묘화 영역**에 맞추는 것을 추천합니다. 제대로 맞추고 Keep Aspect를 유효하게 하면 LR2 측에서의 리사이즈가 발생하지 않으므로 종횡비 유지가 실현됩니다.
- Algo: 리사이즈 알고리즘을 선택합니다.
  - Nearest Neighbor: 가장 빠르지만 화질은 낮습니다.
  - Bilinear: 성능과 화질의 균형이 좋습니다. 전력으로 병렬화되어 있습니다.
- Brightness: 슬라이더로 BGA의 밝기를 조정합니다.

### External Window

드래그로 이동이 가능합니다.

- [ ] Enable: 외부 창에서 BGA를 표시합니다.
- [ ] Passthrough: 입력 해상도 그대로 외부 창에 출력합니다. Size로 설정한 값은 무시됩니다. 블랙 바 제거는 적용됩니다.
- [ ] Keep Aspect: 입력 동영상의 종횡비를 유지하기 위해 블랙 바를 부가하여 외부 창에 출력합니다.
- Pos: 외부 창의 표시 위치를 설정합니다. 마우스로 이동한 위치는 자동으로 저장됩니다.
- Size: 외부 창의 크기를 설정합니다.
- Algo: 리사이즈 알고리즘을 선택합니다. LR2와 외부 창에서 따로따로 설정할 수 있습니다.
- Z-Order: 외부 창의 Z-Order를 설정합니다.
  - Top: 항상 맨 앞에 표시합니다.
  - Bottom: 기동 시에 맨 뒤에 표시합니다.
- Brightness: 슬라이더로 BGA의 밝기를 조정합니다. 검은 일색의 오버레이 윈도우의 투명도를 조정합니다. 이것에 의해 OBS 등의 캡쳐 소프트로 밝기 조정 전의 BGA를 캡처할 수 있습니다.

### External Window Close Triggers

- [ ] R-Click: 외부 창을 우클릭으로 닫게 됩니다.
- [ ] Gamepad: 게임 패드의 지정한 버튼을 누르면 외부 창을 닫습니다.
  - [ ] ID: 게임 패드의 ID를 설정합니다. 1개 밖에 게임 패드를 접속하지 않은 경우는 0일 것입니다.
  - [ ] Btn: 게임 패드의 버튼 번호를 설정합니다.
  - ID와 Btn는 후술 하는 설정으로 유효화할 수 있는 디버그 윈도우의 표시를 참고로 해 주세요.
- [ ] Keyboard: 키보드의 지정한 키를 누르면 외부 창을 닫습니다.
  - Key Code: 키 코드를 설정합니다. 16진수로 입력합니다. 예: 0xD (Enter 키). 디버그 윈도우의 표시를 참고로 해 주세요.
- [ ] Result Screen: 리잘트 화면 천이 시에 자동으로 외부 창을 닫습니다.
  - *주의*: **이 기능은 LR2의 메모리를 읽어내는 것으로 리잘트 화면 천이를 검지합니다. 클린한 구현이라고는 말할 수 없기 때문에 신경이 쓰이는 분은 사용하지 말아 주세요.**

### Auto Letterbox Removal

16:9 로의 크롭과 4:3 으로의 크롭에 대응하고 있습니다.

- [ ] Enable: 블랙 바 제거를 유효하게 합니다.
- Threshold: 블랙 바 제거의 임계치를 설정합니다. 임계치 이하 밝기의 픽셀을 흑으로서 판정에 사용합니다.
- Stable: 블랙 바 제거 변환의 연속 판정 횟수를 설정합니다. 200ms초에 1회 판정을 실시하므로, 3을 설정하면 600ms초 이상 블랙 바가 계속되지 않으면 블랙 바가 제거되지 않습니다.

### Other

- [ ] Debug Mode (Info Window): 동영상 재생 중에 디버그 윈도우를 표시합니다. 게임 패드의 버튼 번호나 키 코드 등을 확인할 수 있습니다.
- [ ] Auto Open Properties: 동영상 재생 시에 설정 화면이 자동으로 열리게 됩니다. 초기 설정 시에 편리합니다.

## 보충

- 설정치는 레지스트리 `HKEY_CURRENT_USER\SOFTWARE\LR2BGAFilter`에 보존됩니다. 설정 파일이 아닌 레지스트리를 이용하는 이유는, 동영상 재생 시에 파일 IO를 발생시키지 않고 기동 속도를 저하시키지 않기 때문입니다.
- 처리 순서를 알기 힘들지도 모르기 때문에 보충합니다.
  - 블랙 바 제거는 입력된 프레임에 대해서 최초로 행해집니다.
  - 그래서 LR2용으로 1:1으로 블랙 바가 붙어 있는 BGA에 블랙 바 제거를 적용해, Keep Aspect 무효로 출력하면, 세로로 늘어난 BGA가 표시된다고 생각합니다. Keep Aspect를 유효하게 하면 원래의 1:1으로 블랙 바가 붙은 BGA와 같은 외형이 된다고 생각합니다.
  - 원래 16:9로 블랙 바가 붙지 않은 BGA에서는 블랙 바 제거는 적용되지 않고, Keep Aspect 유효라면 출력 사이즈에 맞추어 블랙 바가 부가됩니다.
  - **즉 무엇이 말하고 싶은가 하면 Auto Letterbox Removal와 Keep Aspect는 항상 양쪽 모두 유효하게 해 두는 것이 추천입니다.** BGA 표시 영역이 1:1이 아닌 스킨에서도 좋은 느낌으로 표시될 것입니다.
