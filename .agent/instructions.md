# Project Guidelines

## Git運用ルール

本プロジェクトでは以下のGit運用ルールを遵守します。

### 1. ブランチ戦略
- **Main Branch**: `main`
  - `main` ブランチでの直接編集・コミットは**禁止**です。
  - 常にデプロイ可能（ビルド可能）な状態を保ってください。

### 2. 作業フロー
1.  **ブランチ作成**:
    - 新しいタスク（バグ修正、機能追加、リファクタリングなど）を開始する際は、必ず最新の `main` から新しいブランチを作成してください。
2.  **ブランチ命名規則**:
    - 機能追加: `feature/機能名` (例: `feature/add-overlay-window`)
    - バグ修正: `fix/バグ内容` (例: `fix/overlay-visibility`)
    - リファクタリング: `refactor/対象` (例: `refactor/thread-safety`)
3.  **コミット運用**:
    - 変更内容は論理的な単位で分割し、分かりやすくコミットしてください。
    - コミットメッセージは日本語で記述し、変更の意図を明確にしてください。
    - **AI作成のコミット**:
        - 接頭辞 `🤖` を必ず付与してください。
        - メッセージ末尾に空行を挟んで `Co-authored-by: Antigravity Agent <antigravity-agent@google.com>` を追加してください。
4.  **マージ準備**:
    - 作業完了後はリモートへプッシュし、Pull Request (PR) の作成準備またはマージ作業を行ってください。

## その他
- **文字コード**: ソースコードは **UTF-8 with BOM** を統一規格とします。
  - Visual Studio (MSVC) での日本語リテラル/コメントの誤判定（文字化け）を防ぐため、BOM付きが必須です。
  - Git/GitHub での表示互換性のため、Shift-JISは原則廃止します。既存ファイルも順次変換を行います。
- **言語**: コメント、コミットメッセージ、ドキュメントは日本語を使用してください。

## コーディング規約 (Technical Guidelines)

1.  **言語基準**: C++17 (Visual Studio 2022)
    -   スマートポインタ (`std::unique_ptr`, `std::shared_ptr`) を積極的に使用し、生の `new`/`delete` は極力避ける (RAII原則)。
    -   標準ライブラリ (`std::vector`, `std::string`, `std::thread` 等) を優先して使用する。
    -   DirectShow 固有のオブジェクト (COMインターフェース) の管理には `CComPtr` や `CheckPointer` マクロを活用する。

2.  **エラーハンドリング**:
    -   HRESULT を常にチェックする。
    -   例外 (`try-catch`) は原則使用せず、戻り値 (HRESULT) でエラーを伝播させる (DirectShowの慣習)。
    -   致命的なエラー以外でクラッシュさせない (ロバスト性重視)。

3.  **命名規則**:
    -   クラス名: `C` プレフィックス (例: `CLR2BGAFilter`)
    -   インターフェース名: `I` プレフィックス (例: `ILR2BGAFilterSettings`)
    -   メンバ変数: `m_` プレフィックス (例: `m_width`)
    -   グローバル変数: `g_` プレフィックス
    -   関数名: PascalCase (例: `ProcessFrame`)
    -   変数名: camelCase (例: `inputWidth`)

4.  **コメント (重要)**:
    -   **言語**: 必ず **日本語** で記述すること。
    -   **内容**: コードが「何をしているか」だけでなく、「なぜそう実装したか」という **設計意図** や **背景** を含めること。
    -   **ヘッダ**: クラスや主要な関数には、役割と引数・戻り値の説明コメントを付記する。

5.  **ビルド検証**:
    -   本プロジェクトは **32bit (x86/Win32)** アプリケーション向けです。
    -   コード変更後は必ず `Release|Win32` 構成でビルドし、コンパイルエラーやリンクエラーがないことを確認する。

6.  **定数化ルール**:
    -   マジックナンバー（意味を持つ数値リテラル）は直接コードに記述しない。
    -   `constexpr` または `const` を使用して名前付き定数として定義する。
    -   例: `constexpr DWORD kLetterboxCheckIntervalMs = 200;`

7.  **スレッド安全性とロック管理**:
    -   複数のミューテックスを使用する場合、デッドロック防止のため**取得順序をコメントに明記**する。
    -   ロックの保持期間は最小限に抑え、ロック中にGUI操作（`SendMessage`等）を行わない。
    -   例:
        ```cpp
        // ロック順序: m_mtxSettings -> m_mtxBuffer (必ずこの順で取得)
        std::lock_guard<std::mutex> lock1(m_mtxSettings);
        std::lock_guard<std::mutex> lock2(m_mtxBuffer);
        ```

8.  **コードサイズ目安**:
    -   **関数**: 200行を超える場合は、責務の分割を検討する。
    -   **ファイル**: 1000行を超える場合は、クラスまたはモジュールの分割を検討する。
    -   目安を超えても正当な理由があれば許容するが、レビュー時に説明を求められる。
